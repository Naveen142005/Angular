<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dynamic Dashboard Widgets</title>
<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
  }

  h2 {
    margin-bottom: 10px;
  }

  button {
    margin-bottom: 15px;
    padding: 8px 12px;
    cursor: pointer;
  }

  .dashboard {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
  }

  .widget {
    width: 150px;
    height: 100px;
    background: #f9f9f9;
    border: 1px solid #ccc;
    border-radius: 6px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: grab;
    user-select: none;
  }

  .widget.dragging {
    opacity: 0.5;
    border: 2px dashed #999;
  }
</style>
</head>
<body>

<h2>Dynamic Dashboard Widgets</h2>
<button id="addWidgetBtn">Add Widget</button>

<div id="dashboard" class="dashboard">
  <div class="widget" draggable="true">Widget 1</div>
  <div class="widget" draggable="true">Widget 2</div>
  <div class="widget" draggable="true">Widget 3</div>
</div>

<script>
const dashboard = document.getElementById('dashboard');
const addBtn = document.getElementById('addWidgetBtn');
let widgetCount = 3;
let dragged;

function getDragAfterElement(container, x, y) {
  const draggableElements = [...container.querySelectorAll('.widget:not(.dragging)')];

  return draggableElements.reduce((closest, child) => {
    const box = child.getBoundingClientRect();
    const offset = y - box.top - box.height / 2;
    if (offset < 0 && offset > closest.offset) {
      return { offset: offset, element: child };
    } else {
      return closest;
    }
  }, { offset: Number.NEGATIVE_INFINITY }).element;
}

// Drag and drop logic
dashboard.addEventListener('dragstart', e => {
  dragged = e.target;
  e.target.classList.add('dragging');
});

dashboard.addEventListener('dragend', e => {
  e.target.classList.remove('dragging');
});

dashboard.addEventListener('dragover', e => {
  e.preventDefault();
  const afterElement = getDragAfterElement(dashboard, e.clientX, e.clientY);
  if (afterElement == null) {
    dashboard.appendChild(dragged);
  } else {
    dashboard.insertBefore(dragged, afterElement);
  }
});

// Add new widget dynamically
addBtn.addEventListener('click', () => {
  widgetCount++;
  const widget = document.createElement('div');
  widget.classList.add('widget');
  widget.setAttribute('draggable', 'true');
  widget.textContent = `Widget ${widgetCount}`;
  dashboard.appendChild(widget);
});
</script>

</body>
</html>
